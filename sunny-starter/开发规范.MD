## Sunny 应用开发框架


### 开发规范 
详细参考《阿里巴巴Java开发规范》
> #### 编程规约
* 常量命名全部大写，单词间用下划线隔开，力求语义表达完整清楚，不要嫌名字长。
* 杜绝完全不规范的缩写，避免望文不知义
* Service/DAO 层方法命名规约
  * 获取单个对象的方法用 `get` 做前缀。
  * 获取多个对象的方法用 `list` 做前缀。
  * 获取统计值的方法用 `count` 做前缀。
  * 插入的方法用 `save/insert` 做前缀。
  * 删除的方法用 `remove/delete` 做前缀。
  * 修改的方法用 `update` 做前缀。
* 分层领域模型规约
  * `DO`（Data Object）：与数据库表结构一一对应，通过 DAO 层向上传输数据源对象。
  * `DTO`（Data Transfer Object）：数据传输对象，Service 或 Manager 向外传输的对象。
  * `BO`（Business Object）：业务对象。由 Service 层输出的封装业务逻辑的对象。
  * `AO`（Application Object）：应用对象。在 Web 层与 Service 层之间抽象的复用对象模型，极为贴近展示层，复用度不高。
  * `VO`（View Object）：显示层对象，通常是 Web 向模板渲染引擎层传输的对象。   
* 不允许任何魔法值（即未经定义的常量）直接出现在代码中。
* 采用 4 个空格缩进，禁止使用 tab 字符
* 避免通过一个类的对象引用访问此类的静态变量或静态方法，直接用类名来访问即可。
* 不能使用过时的类或方法。
* 所有的相同类型的包装类对象之间值的比较，全部使用 `equals` 方法比较。
* 构造方法里面禁止加入任何业务逻辑，如果有初始化逻辑，请放在 `init` 方法中。
* 类内方法定义顺序依次是：公有方法或保护方法 > 私有方法 > getter/setter方法。
* 循环体内，字符串的连接方式，使用 `StringBuilder` 的 `append` 方法进行扩展。
* 集合初始化时，指定集合初始值大小。
* 线程资源必须通过线程池提供，不允许在应用中自行显式创建线程。
* 类、类属性、类方法的注释必须使用 Javadoc 规范，使用/\*\*内容*/格式，不得使用// xxx 方式。
* 所有的类都必须添加创建者和创建日期。
* 获取当前毫秒数 `System.currentTimeMillis()`; 而不是 `new Date().getTime()`;
> #### 异常规约
* 异常不要用来做流程控制、条件控制，因为异常的处理效率比条件分支低。
* 对大段代码进行 `try-catch`，这是不负责任的表现。`catch` 时请分清稳定代码和非稳定代码。对于非稳定代码的 `catch` 尽可能进行区分异常类型，再做对应的异常处理。
* 捕获异常是为了处理它，不要捕获了却什么都不处理而抛弃之，如果不想处理它，请将该异常抛给它的调用者。最外层的业务使用者，必须处理异常，将其转化为用户可以理解的内容。
* 防止 NPE(`NullPointerException`)，是程序员的基本修养。
* 定义异常时区分 `unchecked/checked` 异常，避免直接抛出 `new RuntimeException()`，更不允许抛出 `Exception` 或者 `Throwable`，应使用有业务含义的自定义异常。
> #### 安全规约
* 隶属于用户个人的页面或者功能必须进行权限控制校验。
* 用户敏感数据禁止直接展示，必须对展示数据进行脱敏。
* 用户请求传入的任何参数必须做有效性验证。
* 表单、AJAX 提交必须执行 `CSRF` 安全过滤。
* 发贴、评论、发送即时消息等用户生成内容的场景必须实现防刷、文本内容违禁词过滤等风控策略。
> #### MySQL 数据库
* 表名不使用复数名词。
* 主键索引名为 pk_字段名；唯一索引名为 uk_字段名；普通索引名则为 idx_字段名。
* 小数类型为 `decimal`，禁止使用 `float` 和 `double`。如果存储的数据范围超过 `decimal` 的范围，建议将数据拆成整数和小数分开存储。
* 如果存储的字符串长度几乎相等，使用 char 定长字符串类型。
* 单表行数超过 500 万行或者单表容量超过 2GB，才推荐进行分库分表。
* 业务上具有唯一特性的字段，即使是多个字段的组合，也必须建成唯一索引。
* 在 `varchar` 字段上建立索引时，必须指定索引长度，没必要对全字段建立索引，根据实际文本区分度决定索引长度即可。
* 防止因字段类型不同造成的隐式转换，导致索引失效。
* 数据订正时，删除和修改记录时，要先 `select`，避免出现误删除，确认无误才能执行更新语句。
* 在表查询中，一律不要使用 * 作为查询的字段列表，需要哪些字段必须明确写明。
* 配置映射关系(`resultMap`)，使字段与 `DO` 类解耦，方便维护。
